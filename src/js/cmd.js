"use strict";function save(t){t!==cmdHistory.arr[cmdHistory.step-1]&&(cmdHistory.step<cmdHistory.arr.length-1&&cmdHistory.arr.splice(cmdHistory.step+1,cmdHistory.arr.length-cmdHistory.step-1),cmdHistory.arr.push(t),cmdHistory.step++,processing())}function undo(){cmdHistory.step-1<0||(cmdHistory.step--,document.querySelector("#cmd").innerText=cmdHistory.arr[cmdHistory.step],processing())}function redo(){cmdHistory.step+1>=cmdHistory.arr.length||(cmdHistory.step++,document.querySelector("#cmd").innerText=cmdHistory.arr[cmdHistory.step],processing())}function throttle(t,e){var n=void 0;return function(){var r=arguments,i=this;n||(t.apply(i,r),n=!0,setTimeout(function(){return n=!1},e))}}function calibrationInput(){var t=outputEl.scrollLeft/(outputEl.scrollWidth-outputEl.clientWidth),e=outputEl.scrollTop/(outputEl.scrollHeight-outputEl.clientHeight);inputEl.scrollLeft=t*(inputEl.scrollWidth-inputEl.clientWidth),inputEl.scrollTop=e*(inputEl.scrollHeight-inputEl.clientHeight)}function calibrationOutput(){var t=inputEl.scrollLeft/(inputEl.scrollWidth-inputEl.clientWidth),e=inputEl.scrollTop/(inputEl.scrollHeight-inputEl.clientHeight);outputEl.scrollLeft=t*(outputEl.scrollWidth-outputEl.clientWidth),outputEl.scrollTop=e*(outputEl.scrollHeight-outputEl.clientHeight)}function findParameter(t){var e=0,n="",r=!1,i=!0,o=!1,u=void 0;try{for(var l,s=t[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value;if("["===c?(e++,r=!0):"]"===c&&e--,r&&(n+=c),0===e&&r)break}}catch(t){o=!0,u=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw u}}return n}function copy(){copy_code("output","复制命令成功","复制失败，输出是空的")}function download(){var t=document.getElementById("output").innerText,e=document.createElement("a"),n=new Blob([t],{type:"text/plain"});if(""===t.trim())return void sdui.toast({text:"下载失败，输出是空的",anchor:"bottom",type:"error"});sdui.toast({text:"下载成功",anchor:"bottom",type:"success"}),e.setAttribute("href",window.URL.createObjectURL(n)),e.setAttribute("download","output"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function processing(){document.getElementById("output").innerText="",targetApi=parseFloat(document.getElementById("targetapi").value),document.getElementById("cmd").innerText.split("\n").forEach(function(t,e){line(t.trim())}),document.getElementById("output").innerText=document.getElementById("output").innerText.replace(/\n\n/g,"\n")}function line(t){var e=document.getElementById("output");e.innerHTML;if(t.startsWith("execute")){for(var n,r=[[]],i=[],o=0,u=0,l=/(@[a-zA-Z])|("?.*?("|\s))/,s=/([\^~]?-?\d*(\.\d+)?\s*[\^~]?-?\d*(\.\d+)?\s*[\^~]?-?\d*(\.\d+)?)/g,c=/.*?(?=\d)/g,d=/\d+/g;""!==t;)t=t.trimLeft(),0===o?(r[u].push("execute"),t=t.substring(7)):1===o?(n=t.match(l),selectos=n[1]||n[2],selectos=2===selectos.length&&"["===t[2]?selectos+findParameter(t):selectos,r[u].push(selectos),t=t.substring(selectos.length)):2===o?(n=t.match(s),r[u].push(n[0]),t=t.substring(n[0].length)):3===o?t.startsWith("execute")?(r.push([]),u++,o=-1):t.startsWith("detect")?(r[u].push("detect"),t=t.substring(6)):(r[u].push(t),t=""):4===o?(n=t.match(s),r[u].push(n[0]),t=t.substring(n[0].length)):5===o?(n=t.match(c),r[u].push(n[0].trimRight()),t=t.substring(n[0].trimRight().length)):6===o?(n=t.match(d),r[u].push(n[0]),t=t.substring(n[0].length)):7===o&&(t.startsWith("execute")?(r.push([]),u++,o=-1):(r[u].push(t),t="")),o++;r.forEach(function(t,e){var n=t[2].replaceAll(" ",""),r="~~~"===n||"^^^"===n?"":" positioned "+t[2],o="@s"===t[1]?"":"as "+t[1]+" at @s",u=o+r;"detect"===t[3]?i.push((0===e?"execute ":"")+u+(""===u?"if block ":" if block ")+t[4]+" "+t[5]+(targetApi<1970?" "+t[6]:"")+(t[7]?" run "+t[7]:"")):i.push((0===e?"execute ":"")+u+(t[3]?" run "+t[3]:""))}),e.innerText+=""===e.innerText.trim()?i.join(" "):"\n"+i.join(" ")}else e.innerText+=""===e.innerText.trim()?t:"\n"+t}var cmdHistory={step:0,arr:[]},targetApi=parseFloat(document.getElementById("targetapi").value),inputEl=document.getElementById("cmd"),outputEl=document.getElementById("output");document.getElementById("cmd").addEventListener("blur",function(){save(document.getElementById("cmd").innerText)}),inputEl.addEventListener("scroll",throttle(calibrationOutput,5)),outputEl.addEventListener("scroll",throttle(calibrationInput,5));
